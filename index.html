<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Leaflet Map</title>
    <!-- Include Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>

<!-- Create a div to hold your map -->
<div id="map" style="height: 600px;"></div>

<!-- Include Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Include Chroma.js for color scaling -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
    // Initialize the map
    var m = L.map('map').setView([32.73231057225321, -97.11378884978785], 16);

    // Add a tile layer (you can change the tile URL to your preference)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(m);

    // Define a red gradient for pressure levels
    var red_gradient = ['#fee5d9', '#fcae91', '#fb6a4a', '#de2d26'];

    // Function to load and process a CSV file
    function loadCSV(filePath) {
        return fetch(filePath)
            .then(response => response.text())
            .then(data => {
                var rows = data.trim().split('\n').slice(1); // Assuming the first row is the header
                var snapped_df = rows.map(row => {
                    var columns = row.split(',');
                    return {
                        snapped_latitude: parseFloat(columns[0]),
                        snapped_longitude: parseFloat(columns[1]),
                        pressure_level: parseInt(columns[2])
                    };
                });

                // Iterate through the DataFrame to create colored polylines based on pressure level
                for (var i = 0; i < snapped_df.length - 1; i++) {
                    var start_point = [snapped_df[i].snapped_latitude, snapped_df[i].snapped_longitude];
                    var end_point = [snapped_df[i + 1].snapped_latitude, snapped_df[i + 1].snapped_longitude];
                    var pressure_level = snapped_df[i].pressure_level;

                    // Choose a color based on pressure level using the red gradient
                    var color = red_gradient[pressure_level - 1];

                    // Create a polyline segment and add it to the map
                    L.polyline([start_point, end_point], { color: color, weight: 5 }).addTo(m);
                }
            })
            .catch(error => console.error(error));
    }

    // Function to iterate over a folder of CSV files
    function processCSVFiles(folderPath, numFiles) {
        var promises = [];

        for (var i = 0; i < numFiles; i++) {
            var filePath = `${folderPath}/dataframe_${i}.csv`;
            promises.push(loadCSV(filePath));
        }

        // After all promises are resolved, log a message
        return Promise.all(promises)
            .then(function() {
                console.log('All CSV files processed');
            })
            .catch(error => console.error(error));
    }

    // Call the function to process CSV files in a folder
    processCSVFiles('dataframes', 61);
</script>

</body>
</html>
