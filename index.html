<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Leaflet Map</title>
    <!-- Include Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>

<!-- Create a div to hold your map -->
<div id="map" style="height: 600px;"></div>

<!-- Include Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- Include Chroma.js for color scaling -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<!-- ... (your existing HTML code) ... -->

<script>
    // Initialize the map
    var map = L.map('map').setView([32.73231057225321, -97.11378884978785], 16);

    // Add a tile layer (you can change the tile URL to your preference)
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Load and process each CSV file
    var numDataframes = 61; // Set the number of dataframes you have

    // Function to process a CSV file
    function processCSV(index) {
        return new Promise(function(resolve) {
            Papa.parse(`dataframes/dataframe_${index}.csv`, {
                header: true,
                dynamicTyping: true,
                complete: function (result) {
                    var dataf = result.data;

                    for (var j = 0; j < dataf.length - 1; j++) {
                        var startLatLng = [dataf[j]['snapped_latitude'], dataf[j]['snapped_longitude']];
                        var endLatLng = [dataf[j + 1]['snapped_latitude'], dataf[j + 1]['snapped_longitude']];
                        var pressureLevel = dataf[j]['average_label'];

                        // Add your color scaling logic here
                        var colorScale = chroma.scale('YlOrRd').domain([0, 3]);
                        var color = colorScale(pressureLevel).hex();

                        // Create a polyline and add it to the map
                        L.polyline([startLatLng, endLatLng], { color: color, weight: 2 }).addTo(map);
                    }

                    resolve(); // Resolve the promise when processing is done
                }
            });
        });
    }

    // Process each CSV file sequentially using promises
    var promises = [];

    for (var i = 0; i < numDataframes; i++) {
        promises.push(processCSV(i));
    }

    // After all promises are resolved, log a message
    Promise.all(promises).then(function() {
        console.log('All CSV files processed');
    });
</script>

<!-- ... (rest of your HTML code) ... -->

</body>
</html>
